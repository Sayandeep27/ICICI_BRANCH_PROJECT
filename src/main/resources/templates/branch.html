<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Branch Visual Checklist</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container py-4">
  <h2>Branch Visual Checklist</h2>
  <div class="mb-3">
    <label>Select Branch</label>
    <select id="branchSelect" class="form-select">
      <option value="">-- choose branch --</option>
      <th:block th:each="b : ${branches}">
        <option th:value="${b.id}" th:text="${b.name}"></option>
      </th:block>
    </select>
  </div>

  <div class="mb-3">
    <label>SOL ID</label>
    <input id="solId" class="form-control" readonly/>
  </div>

  <button id="nextBtn" class="btn btn-primary" disabled>Next</button>

  <script>
    const token = new URLSearchParams(location.search).get('token');
    $('#branchSelect').on('change', function() {
      const id = $(this).val();
      if (!id) { $('#solId').val(''); $('#nextBtn').prop('disabled', true); return; }
      $.get('/api/branch/' + id, function(data) {
        $('#solId').val(data.solId);
        $('#nextBtn').prop('disabled', false);
      });
    });

    $('#nextBtn').on('click', function() {
      const branchId = $('#branchSelect').val();
      if (!branchId) return alert('Select branch');
      const url = '/checklist?branchId=' + branchId + '&token=' + encodeURIComponent(token || '');
      location.href = url;
    });
  </script>
</body>
</html>
